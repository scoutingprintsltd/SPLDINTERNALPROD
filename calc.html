<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendar Sales Calculator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        h2 {
            color: #1a237e;
        }
        .input-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
        }
        input[type="range"] {
            width: 100%;
        }
        .profit-summary {
            background-color: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
        }
        .info-message {
            background-color: #e8f5e9;
            padding: 10px;
            border-radius: 5px;
            margin-top: 20px;
        }
        .internal-details {
            background-color: #fffde7;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h2>Calendar Sales Calculator</h2>
    
    <div class="input-group">
        <label for="selling-price">Selling Price: £<span id="selling-price-display">14.00</span></label>
        <input type="range" id="selling-price" min="7" max="35" step="0.5" value="14">
        <div class="range-labels">
            <span id="min-selling-price">£7</span>
            <span>£35</span>
        </div>
    </div>

    <div class="input-group">
        <label for="quantity">Quantity to Sell: <span id="quantity-display">100</span></label>
        <input type="range" id="quantity" min="1" max="300" step="1" value="100">
        <div class="range-labels">
            <span>1</span>
            <span>300</span>
        </div>
    </div>

    <div class="profit-summary">
        <h3>Profit Summary</h3>
        <p style="font-size: 24px; font-weight: bold; color: #1565c0;">£<span id="client-profit">568.48</span></p>
        <p>Your Profit for <span id="quantity-summary">100</span> calendars</p>
        <p>Price per calendar: £<span id="price-per-calendar">14.00</span></p>
    </div>

    <div class="info-message">
        <p>This will all be confirmed when you start your calendar creation. No risk to you.</p>
    </div>

    <div class="internal-details">
        <h3>Internal Business Details</h3>
        <p>Supplier Cost: £<span id="supplier-cost">264.67</span></p>
        <p>VAT (20%): £<span id="vat-cost">52.93</span></p>
        <p>Our Profit (45% - shared VAT): £<span id="our-profit">438.65</span></p>
        <p>Shopify Fees: £<span id="shopify-fees">48.80</span></p>
        <p>Net Profit: £<span id="net-profit">389.85</span></p>
        <p>Client Profit: £<span id="client-profit-details">568.48</span></p>
    </div>

    <script>
        const priceTable = {
            1: 13.43, 2: 20.46, 3: 26.52, 4: 32.59, 5: 39.94,
            6: 46.97, 7: 54.19, 8: 60.65, 9: 67.11, 10: 73.57,
            11: 77.93, 12: 78.91, 13: 79.9, 14: 80.88, 15: 83.72,
            16: 92.54, 17: 98.38, 18: 102.72, 19: 107.13, 20: 111.64,
            25: 125.89, 50: 209.99, 100: 264.67, 150: 319.36, 200: 382.08
        };

        const quantityTiers = Object.keys(priceTable).map(Number).sort((a, b) => a - b);

        function getPriceForQuantity(qty) {
            if (priceTable[qty]) {
                return priceTable[qty];
            } else {
                const lowerTier = quantityTiers.filter(tier => tier <= qty).pop();
                const upperTier = quantityTiers.find(tier => tier > qty);
                
                if (!upperTier) {
                    return priceTable[lowerTier] * (qty / lowerTier);
                }

                const lowerPrice = priceTable[lowerTier];
                const upperPrice = priceTable[upperTier];
                const priceDiff = upperPrice - lowerPrice;
                const quantityDiff = upperTier - lowerTier;
                const ratio = (qty - lowerTier) / quantityDiff;

                return lowerPrice + (priceDiff * ratio);
            }
        }

        function calculateShopifyFees(price, qty) {
            return (price * qty * 0.017) + (0.25 * qty);
        }

        function updateCalculations() {
            const sellingPrice = parseFloat(document.getElementById('selling-price').value);
            const quantity = parseInt(document.getElementById('quantity').value);

            document.getElementById('selling-price-display').textContent = sellingPrice.toFixed(2);
            document.getElementById('quantity-display').textContent = quantity;
            document.getElementById('quantity-summary').textContent = quantity;
            document.getElementById('price-per-calendar').textContent = sellingPrice.toFixed(2);

            if (quantity <= 250) {
                const baseCost = getPriceForQuantity(quantity);
                const vatAmount = baseCost * 0.2; // 20% VAT
                const totalCost = baseCost + vatAmount;
                
                document.getElementById('supplier-cost').textContent = baseCost.toFixed(2);
                document.getElementById('vat-cost').textContent = vatAmount.toFixed(2);
                
                const costPerCalendar = totalCost / quantity;
                
                // Calculate minimum selling price based on 45% profit margin and shared VAT cost
                const sharedVatCost = vatAmount / 2; // Split VAT cost 50/50
                const newMinSellingPrice = Math.ceil((costPerCalendar + (sharedVatCost / quantity)) / 0.55); // 45% profit margin
                document.getElementById('min-selling-price').textContent = `£${newMinSellingPrice}`;
                document.getElementById('selling-price').min = newMinSellingPrice;
                
                // Adjust selling price if it's below the new minimum
                const adjustedSellingPrice = Math.max(sellingPrice, newMinSellingPrice);
                document.getElementById('selling-price').value = adjustedSellingPrice;
                document.getElementById('selling-price-display').textContent = adjustedSellingPrice.toFixed(2);

                const totalRevenue = adjustedSellingPrice * quantity;
                const fees = calculateShopifyFees(adjustedSellingPrice, quantity);
                document.getElementById('shopify-fees').textContent = fees.toFixed(2);

                const totalProfit = totalRevenue - totalCost - fees;
                const calculatedOurProfit = (totalProfit * 0.45) - sharedVatCost; // 45% of profit minus shared VAT cost
                document.getElementById('our-profit').textContent = calculatedOurProfit.toFixed(2);

                const calculatedClientProfit = totalProfit - calculatedOurProfit - sharedVatCost;
                document.getElementById('client-profit').textContent = calculatedClientProfit.toFixed(2);
                document.getElementById('client-profit-details').textContent = calculatedClientProfit.toFixed(2);

                document.getElementById('net-profit').textContent = (calculatedOurProfit - fees).toFixed(2);

                document.querySelector('.profit-summary').style.display = 'block';
                document.querySelector('.internal-details').style.display = 'block';
            } else {
                document.querySelector('.profit-summary').innerHTML = `
                    <h3>Contact Sales</h3>
                    <p>For orders over 250 units, please contact our sales team for a custom quote and potential bulk discounts.</p>
                `;
                document.querySelector('.internal-details').style.display = 'none';
            }
        }

        document.getElementById('selling-price').addEventListener('input', updateCalculations);
        document.getElementById('quantity').addEventListener('input', updateCalculations);

        // Initial calculation
        updateCalculations();
    </script>
</body>
</html>
